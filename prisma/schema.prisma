generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Item {
  id         String         @id @default(cuid())
  url        String?
  title      String
  type       String         @default("article")
  createdAt  DateTime       @default(now()) @map("created_at")
  updatedAt  DateTime       @updatedAt @map("updated_at")

  // Rich metadata (extracted from URL)
  description    String?         @default("")
  imageUrl       String?         @map("image_url")
  imageWidth     Int?            @map("image_width")
  imageHeight    Int?            @map("image_height")
  faviconUrl     String?         @map("favicon_url")
  siteName       String?         @map("site_name")
  author         String?
  publishedAt    DateTime?       @map("published_at")
  wordCount      Int?            @map("word_count")
  readingTime    Int?            @map("reading_time")

  // Item status workflow
  status         String          @default("inbox")

  // Metadata extraction status
  metadataStatus String          @default("pending") @map("metadata_status")

  // Enrichment tracking
  enrichmentSource String?       @map("enrichment_source")
  rawInput         String        @map("raw_input")
  pageCount        Int?          @map("page_count")

  // Tags relation
  tags ItemTag[]

  // Common query patterns (feeds, filtering, sorting)
  @@index([url])
  @@index([createdAt])
  @@index([status, createdAt])
  @@index([type, createdAt])
  @@index([type, rawInput])
  @@index([publishedAt])
  @@index([readingTime])
  @@map("items")
}

model Tag {
  id              String    @id @default(cuid())
  name            String
  slug            String    @unique
  color           String    @default("#6b7280")
  isAutoGenerated Boolean   @default(false) @map("is_auto_generated")
  createdAt       DateTime  @default(now()) @map("created_at")
  items           ItemTag[]

  @@map("tags")
}

model ItemTag {
  id              String   @id @default(cuid())
  itemId          String   @map("item_id")
  tagId           String   @map("tag_id")
  item            Item     @relation(fields: [itemId], references: [id], onDelete: Cascade)
  tag             Tag      @relation(fields: [tagId], references: [id], onDelete: Cascade)
  isAutoGenerated Boolean  @default(false) @map("is_auto_generated")
  createdAt       DateTime @default(now()) @map("created_at")

  @@unique([itemId, tagId])
  @@index([tagId])
  @@map("item_tags")
}
